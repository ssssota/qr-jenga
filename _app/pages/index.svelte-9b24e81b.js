import{J as ie,K as ae,L as oe,S as H,i as G,s as P,l as k,f as b,r as C,M as V,w as I,x as w,u as J,d as _,B as D,e as z,N as K,c as y,a as E,O,b as d,P as W,H as p,I as ne,p as he,Q as X,R as ue,T as ce,U as Y,V as B,W as fe,X as _e,t as Z,k as M,j as de,g as F,n as q,m as me,Y as x,o as ge,v as ve,Z as pe}from"../chunks/vendor-632559a1.js";class ke{constructor(e){this._size=e,this.matrix=[...Array(e*e)].map(()=>[255,255,255,255])}get size(){return this._size}setPixel(e,t,i){this.matrix[e+t*this.size]=i}rect(e,t,i,u){for(let o=0;o<i;o++)for(let s=0;s<u;s++)this.setPixel(e+o,t+s,[0,0,0,0])}toImageData(){return{data:new Uint8ClampedArray(this.matrix.flat()),width:this.size,height:this.size}}}const be=n=>new ke(n);class ze extends ie{constructor(e){super();this._text=e,this._removed=0,this._text||(this._text=Math.random().toString(36).substring(2));const t=ae.create(this._text,{}).modules;this.matrix=[...Array(t.size)].map((i,u)=>[...Array(t.size)].map((o,s)=>!!t.get(s,u)))}get text(){return this._text}get size(){return this.matrix.length}get removed(){return this._removed}addEventListener(e,t){super.on(e,t)}get(e,t){return this.rangeCheck(e),this.rangeCheck(t),this.matrix[t][e]}remove(e,t){if(!this.get(e,t))throw new Error("Not able to remove black area");this._removed++,this.matrix[t][e]=!1;const i=!this.validateQrCode();return i&&this.dispatchEvent("collapse",{removed:this.removed}),!i}rangeCheck(e){if(e>=this.size)throw new RangeError("Invalid index")}validateQrCode(){const{data:e,width:t,height:i}=this.toImageData(),u=oe(e,t,i);return(u==null?void 0:u.data)===this.text}toImageData(){const e=1,t=this.size*e*5,i=this.size*e,u=Math.floor((t-i)/2);console.log({blockSize:e,canvasSize:t,qrSize:i,margin:u});const o=be(t);for(let s=0;s<this.size;s++)for(let r=0;r<this.size;r++)this.get(s,r)&&o.rect(u+s*e,u+r*e,e,e);return o.toImageData()}dispatchEvent(e,t){this.emit(e,t)}}const ye=n=>new ze(n);function $(n,e,t){const i=n.slice();return i[9]=e[t],i}function ee(n,e,t){const i=n.slice();return i[12]=e[t],i}function te(n){let e,t,i,u,o,s,r;function h(){return n[8](n[12],n[9])}return{c(){e=K("rect"),this.h()},l(l){e=O(l,"rect",{x:!0,y:!0,width:!0,height:!0}),E(e).forEach(_),this.h()},h(){d(e,"x",t=n[12]*n[0]),d(e,"y",i=n[9]*n[0]),d(e,"width",n[0]),d(e,"height",n[0])},m(l,a){b(l,e,a),o=!0,s||(r=B(e,"click",h),s=!0)},p(l,a){n=l,(!o||a&17&&t!==(t=n[12]*n[0]))&&d(e,"x",t),(!o||a&17&&i!==(i=n[9]*n[0]))&&d(e,"y",i),(!o||a&1)&&d(e,"width",n[0]),(!o||a&1)&&d(e,"height",n[0])},i(l){o||(u&&u.end(1),o=!0)},o(l){u=fe(e,_e,{}),o=!1},d(l){l&&_(e),l&&u&&u.end(),s=!1,r()}}}function le(n,e){let t,i=e[4].get(e[12],e[9]),u,o,s=i&&te(e);return{key:n,first:null,c(){t=k(),s&&s.c(),u=k(),this.h()},l(r){t=k(),s&&s.l(r),u=k(),this.h()},h(){this.first=t},m(r,h){b(r,t,h),s&&s.m(r,h),b(r,u,h),o=!0},p(r,h){e=r,h&16&&(i=e[4].get(e[12],e[9])),i?s?(s.p(e,h),h&16&&w(s,1)):(s=te(e),s.c(),w(s,1),s.m(u.parentNode,u)):s&&(C(),J(s,1,1,()=>{s=null}),I())},i(r){o||(w(s),o=!0)},o(r){J(s),o=!1},d(r){r&&_(t),s&&s.d(r),r&&_(u)}}}function re(n,e){let t,i=[],u=new Map,o,s,r=[...Array(e[4].size).keys()];const h=l=>`${l[12]},${l[9]}`;for(let l=0;l<r.length;l+=1){let a=ee(e,r,l),c=h(a);u.set(c,i[l]=le(c,a))}return{key:n,first:null,c(){t=k();for(let l=0;l<i.length;l+=1)i[l].c();o=k(),this.h()},l(l){t=k();for(let a=0;a<i.length;a+=1)i[a].l(l);o=k(),this.h()},h(){this.first=t},m(l,a){b(l,t,a);for(let c=0;c<i.length;c+=1)i[c].m(l,a);b(l,o,a),s=!0},p(l,a){e=l,a&59&&(r=[...Array(e[4].size).keys()],C(),i=V(i,a,h,1,e,r,u,o.parentNode,Y,le,o,ee),I())},i(l){if(!s){for(let a=0;a<r.length;a+=1)w(i[a]);s=!0}},o(l){for(let a=0;a<i.length;a+=1)J(i[a]);s=!1},d(l){l&&_(t);for(let a=0;a<i.length;a+=1)i[a].d(l);l&&_(o)}}}function se(n){let e=[],t=new Map,i,u,o=[...Array(n[4].size).keys()];const s=r=>r[9];for(let r=0;r<o.length;r+=1){let h=$(n,o,r),l=s(h);t.set(l,e[r]=re(l,h))}return{c(){for(let r=0;r<e.length;r+=1)e[r].c();i=k()},l(r){for(let h=0;h<e.length;h+=1)e[h].l(r);i=k()},m(r,h){for(let l=0;l<e.length;l+=1)e[l].m(r,h);b(r,i,h),u=!0},p(r,h){h&59&&(o=[...Array(r[4].size).keys()],C(),e=V(e,h,s,1,r,o,t,i.parentNode,Y,re,i,$),I())},i(r){if(!u){for(let h=0;h<o.length;h+=1)w(e[h]);u=!0}},o(r){for(let h=0;h<e.length;h+=1)J(e[h]);u=!1},d(r){for(let h=0;h<e.length;h+=1)e[h].d(r);r&&_(i)}}}function Ee(n){let e,t,i=n[3],u,o,s=se(n),r=[n[6]],h={};for(let l=0;l<r.length;l+=1)h=D(h,r[l]);return{c(){e=z("div"),t=K("svg"),s.c(),this.h()},l(l){e=y(l,"DIV",{});var a=E(e);t=O(a,"svg",{version:!0,xmlns:!0,viewBox:!0,fill:!0,class:!0});var c=E(t);s.l(c),c.forEach(_),a.forEach(_),this.h()},h(){d(t,"version","1.1"),d(t,"xmlns","http://www.w3.org/2000/svg"),d(t,"viewBox",u="0 0 "+n[4].size*n[0]+" "+n[4].size*n[0]),d(t,"fill",n[2]),d(t,"class","svelte-1ofrr86"),W(e,h)},m(l,a){b(l,e,a),p(e,t),s.m(t,null),o=!0},p(l,[a]){a&8&&P(i,i=l[3])?(C(),J(s,1,1,ne),I(),s=se(l),s.c(),w(s),s.m(t,null)):s.p(l,a),(!o||a&17&&u!==(u="0 0 "+l[4].size*l[0]+" "+l[4].size*l[0]))&&d(t,"viewBox",u),(!o||a&4)&&d(t,"fill",l[2]),W(e,h=he(r,[a&64&&l[6]]))},i(l){o||(w(s),o=!0)},o(l){J(s),o=!1},d(l){l&&_(e),s.d(l)}}}function we(n,e,t){const i=["text","blockSize","autoJudge","color"];let u=X(e,i),{text:o="default"}=e,{blockSize:s=100}=e,{autoJudge:r=!0}=e,{color:h="black"}=e;const l=ue();let a=0,c;const S=(m,g)=>{const Q=c.remove(m,g);l("removeblock"),!Q&&r&&l("collapse",{removed:a}),t(3,a++,a)};return n.$$set=m=>{e=D(D({},e),ce(m)),t(6,u=X(e,i)),"text"in m&&t(7,o=m.text),"blockSize"in m&&t(0,s=m.blockSize),"autoJudge"in m&&t(1,r=m.autoJudge),"color"in m&&t(2,h=m.color)},n.$$.update=()=>{n.$$.dirty&128&&(t(4,c=ye(o)),t(3,a=0),l("reset"))},[s,r,h,a,c,l,u,o,S]}class Je extends H{constructor(e){super();G(this,e,we,Ee,P,{text:7,blockSize:0,autoJudge:1,color:2})}}function Qe(n){let e,t,i,u,o,s,r,h,l,a,c,S,m,g,Q,j,L;return g=new Je({props:{text:n[0],autoJudge:n[1],style:"max-width: 90vmin; max-height: 90vmin; margin: 0 auto;",color:"#246"}}),g.$on("collapse",n[5]),g.$on("removeblock",n[6]),{c(){e=z("header"),t=z("h1"),i=Z("QRcode Jenga"),u=M(),o=z("main"),s=z("p"),r=z("input"),h=M(),l=z("p"),a=z("label"),c=z("input"),S=Z(`
			Auto judge (\u81EA\u5206\u306E\u30B9\u30DE\u30DB\u3067\u5224\u5B9A\u3059\u308B\u5834\u5408\u306F\u30C1\u30A7\u30C3\u30AF\u3092\u5916\u3057\u3066\u304F\u3060\u3055\u3044)`),m=M(),de(g.$$.fragment),this.h()},l(f){e=y(f,"HEADER",{});var v=E(e);t=y(v,"H1",{});var A=E(t);i=F(A,"QRcode Jenga"),A.forEach(_),v.forEach(_),u=q(f),o=y(f,"MAIN",{});var R=E(o);s=y(R,"P",{});var T=E(s);r=y(T,"INPUT",{type:!0,placeholder:!0}),T.forEach(_),h=q(R),l=y(R,"P",{});var U=E(l);a=y(U,"LABEL",{});var N=E(a);c=y(N,"INPUT",{type:!0}),S=F(N,`
			Auto judge (\u81EA\u5206\u306E\u30B9\u30DE\u30DB\u3067\u5224\u5B9A\u3059\u308B\u5834\u5408\u306F\u30C1\u30A7\u30C3\u30AF\u3092\u5916\u3057\u3066\u304F\u3060\u3055\u3044)`),N.forEach(_),U.forEach(_),m=q(R),me(g.$$.fragment,R),R.forEach(_),this.h()},h(){d(r,"type","text"),d(r,"placeholder","QRcode text (random)"),d(c,"type","checkbox")},m(f,v){b(f,e,v),p(e,t),p(t,i),b(f,u,v),b(f,o,v),p(o,s),p(s,r),x(r,n[0]),p(o,h),p(o,l),p(l,a),p(a,c),c.checked=n[1],p(a,S),p(o,m),ge(g,o,null),Q=!0,j||(L=[B(r,"input",n[3]),B(c,"change",n[4])],j=!0)},p(f,[v]){v&1&&r.value!==f[0]&&x(r,f[0]),v&2&&(c.checked=f[1]);const A={};v&1&&(A.text=f[0]),v&2&&(A.autoJudge=f[1]),g.$set(A)},i(f){Q||(w(g.$$.fragment,f),Q=!0)},o(f){J(g.$$.fragment,f),Q=!1},d(f){f&&_(e),f&&_(u),f&&_(o),ve(g),j=!1,pe(L)}}}function Ae(n,e,t){let i="",u=!0;const o=a=>`
    \u208D\u208D\u207D\u207D\u{1F533}\u208E\u208E\u207E\u207E

\u898B\u3066\uFF01QR\u30B3\u30FC\u30C9\u304C\u8E0A\u3063\u3066\u3044\u308B\u3088
\u304B\u308F\u3044\u3044\u306D

        \u{1F533}

\u307F\u3093\u306A\u304CQR\u30B3\u30FC\u30C9\u306E\u9ED2\u3044\u90E8\u5206\u3092\u6D88\u3057\u3066\u3057\u307E\u3063\u305F\u306E\u3067\u3001QR\u30B3\u30FC\u30C9\u306F\u8E0A\u308B\u306E\u3092\u3084\u3081\u3066\u3057\u307E\u3044\u307E\u3057\u305F
\u304A\u524D\u306E\u305B\u3044\u3067\u3059
\u3042\u301C\u3042 (\u8A18\u9332:${a}\u500B)`;function s(){i=this.value,t(0,i)}function r(){u=this.checked,t(1,u)}return[i,u,o,s,r,({detail:a})=>alert(o(a.removed)),()=>console.log("block removed")]}class Se extends H{constructor(e){super();G(this,e,Ae,Qe,P,{})}}export{Se as default};
