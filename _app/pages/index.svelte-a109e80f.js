import{J as O,K as W,L as X,S as C,i as Q,s as y,l as m,f as d,r as k,M as S,w as b,x as p,u as g,d as _,B as w,e as E,N as A,c as R,a as z,O as M,b as f,P as B,H as Y,I as F,p as G,Q as J,R as Z,T as x,U as I,V as N,W as $,X as ee,k as te,j as re,n as le,m as se,Y as j,o as ie,v as ae}from"../chunks/vendor-adca7c21.js";const v=class extends O{constructor(l){super();this._text=l,this._removed=0,this._text||(this._text=Math.random().toString(36).substring(2));const e=W.create(this._text,{}).modules;this.matrix=[...Array(e.size)].map((a,s)=>[...Array(e.size)].map((u,n)=>!!e.get(n,s)))}get text(){return this._text}get size(){return this.matrix.length}get removed(){return this._removed}addEventListener(l,e){super.on(l,e)}get(l,e){return this.rangeCheck(l),this.rangeCheck(e),this.matrix[e][l]}remove(l,e){if(!this.get(l,e))throw new Error("Not able to remove black area");this._removed++,this.matrix[e][l]=!1;const a=!this.validateQrCode();return a&&this.dispatchEvent("collapse",{removed:this.removed}),!a}rangeCheck(l){if(l>=this.size)throw new RangeError("Invalid index")}validateQrCode(){const l=X(this.toImageBuffer(),this.size*v.imageScale,this.size*v.imageScale);return(l==null?void 0:l.data)===this.text}toImageBuffer(){const l=this.matrix.flatMap(e=>{const a=e.map(s=>s?[0,0,0,255]:[255,255,255,255]).flatMap(s=>[...Array(v.imageScale)].flatMap(()=>[...s]));return[...Array(v.imageScale)].flatMap(()=>[...a])});return new Uint8ClampedArray(l)}dispatchEvent(l,e){this.emit(l,e)}};let q=v;q.imageScale=2;const oe=l=>new q(l);function P(l,e,a){const s=l.slice();return s[7]=e[a],s}function T(l,e,a){const s=l.slice();return s[10]=e[a],s}function U(l){let e,a,s,u,n,o,t;function i(){return l[6](l[10],l[7])}return{c(){e=A("rect"),this.h()},l(r){e=M(r,"rect",{fill:!0,x:!0,y:!0,width:!0,height:!0}),z(e).forEach(_),this.h()},h(){f(e,"fill","black"),f(e,"x",a=l[10]*l[0]),f(e,"y",s=l[7]*l[0]),f(e,"width",l[0]),f(e,"height",l[0])},m(r,c){d(r,e,c),n=!0,o||(t=N(e,"click",i),o=!0)},p(r,c){l=r,(!n||c&5&&a!==(a=l[10]*l[0]))&&f(e,"x",a),(!n||c&5&&s!==(s=l[7]*l[0]))&&f(e,"y",s),(!n||c&1)&&f(e,"width",l[0]),(!n||c&1)&&f(e,"height",l[0])},i(r){n||(u&&u.end(1),n=!0)},o(r){u=$(e,ee,{}),n=!1},d(r){r&&_(e),r&&u&&u.end(),o=!1,t()}}}function D(l,e){let a,s=e[2].get(e[10],e[7]),u,n,o=s&&U(e);return{key:l,first:null,c(){a=m(),o&&o.c(),u=m(),this.h()},l(t){a=m(),o&&o.l(t),u=m(),this.h()},h(){this.first=a},m(t,i){d(t,a,i),o&&o.m(t,i),d(t,u,i),n=!0},p(t,i){e=t,i&4&&(s=e[2].get(e[10],e[7])),s?o?(o.p(e,i),i&4&&p(o,1)):(o=U(e),o.c(),p(o,1),o.m(u.parentNode,u)):o&&(k(),g(o,1,1,()=>{o=null}),b())},i(t){n||(p(o),n=!0)},o(t){g(o),n=!1},d(t){t&&_(a),o&&o.d(t),t&&_(u)}}}function L(l,e){let a,s=[],u=new Map,n,o,t=[...Array(e[2].size).keys()];const i=r=>`${r[10]},${r[7]}`;for(let r=0;r<t.length;r+=1){let c=T(e,t,r),h=i(c);u.set(h,s[r]=D(h,c))}return{key:l,first:null,c(){a=m();for(let r=0;r<s.length;r+=1)s[r].c();n=m(),this.h()},l(r){a=m();for(let c=0;c<s.length;c+=1)s[c].l(r);n=m(),this.h()},h(){this.first=a},m(r,c){d(r,a,c);for(let h=0;h<s.length;h+=1)s[h].m(r,c);d(r,n,c),o=!0},p(r,c){e=r,c&15&&(t=[...Array(e[2].size).keys()],k(),s=S(s,c,i,1,e,t,u,n.parentNode,I,D,n,T),b())},i(r){if(!o){for(let c=0;c<t.length;c+=1)p(s[c]);o=!0}},o(r){for(let c=0;c<s.length;c+=1)g(s[c]);o=!1},d(r){r&&_(a);for(let c=0;c<s.length;c+=1)s[c].d(r);r&&_(n)}}}function V(l){let e=[],a=new Map,s,u,n=[...Array(l[2].size).keys()];const o=t=>t[7];for(let t=0;t<n.length;t+=1){let i=P(l,n,t),r=o(i);a.set(r,e[t]=L(r,i))}return{c(){for(let t=0;t<e.length;t+=1)e[t].c();s=m()},l(t){for(let i=0;i<e.length;i+=1)e[i].l(t);s=m()},m(t,i){for(let r=0;r<e.length;r+=1)e[r].m(t,i);d(t,s,i),u=!0},p(t,i){i&15&&(n=[...Array(t[2].size).keys()],k(),e=S(e,i,o,1,t,n,a,s.parentNode,I,L,s,P),b())},i(t){if(!u){for(let i=0;i<n.length;i+=1)p(e[i]);u=!0}},o(t){for(let i=0;i<e.length;i+=1)g(e[i]);u=!1},d(t){for(let i=0;i<e.length;i+=1)e[i].d(t);t&&_(s)}}}function ne(l){let e,a,s=l[1],u,n,o=V(l),t=[l[4]],i={};for(let r=0;r<t.length;r+=1)i=w(i,t[r]);return{c(){e=E("div"),a=A("svg"),o.c(),this.h()},l(r){e=R(r,"DIV",{});var c=z(e);a=M(c,"svg",{version:!0,xmlns:!0,viewBox:!0,class:!0});var h=z(a);o.l(h),h.forEach(_),c.forEach(_),this.h()},h(){f(a,"version","1.1"),f(a,"xmlns","http://www.w3.org/2000/svg"),f(a,"viewBox",u="0 0 "+l[2].size*l[0]+" "+l[2].size*l[0]),f(a,"class","svelte-1ofrr86"),B(e,i)},m(r,c){d(r,e,c),Y(e,a),o.m(a,null),n=!0},p(r,[c]){c&2&&y(s,s=r[1])?(k(),g(o,1,1,F),b(),o=V(r),o.c(),p(o),o.m(a,null)):o.p(r,c),(!n||c&5&&u!==(u="0 0 "+r[2].size*r[0]+" "+r[2].size*r[0]))&&f(a,"viewBox",u),B(e,i=G(t,[c&16&&r[4]]))},i(r){n||(p(o),n=!0)},o(r){g(o),n=!1},d(r){r&&_(e),o.d(r)}}}function ce(l,e,a){const s=["text","blockSize"];let u=J(e,s),{text:n="default"}=e,{blockSize:o=100}=e;const t=Z();let i=0,r;const c=(h,H)=>{const K=r.remove(h,H);t("removeblock"),K||t("collapse",{removed:i}),a(1,i++,i)};return l.$$set=h=>{e=w(w({},e),x(h)),a(4,u=J(e,s)),"text"in h&&a(5,n=h.text),"blockSize"in h&&a(0,o=h.blockSize)},l.$$.update=()=>{l.$$.dirty&32&&(a(2,r=oe(n)),a(1,i=0),t("reset"))},[o,i,r,t,u,n,c]}class ue extends C{constructor(e){super();Q(this,e,ce,ne,y,{text:5,blockSize:0})}}function he(l){let e,a,s,u,n,o;return s=new ue({props:{text:l[0],style:"max-width: 90vmin; max-height: 90vmin; margin: 0 auto;"}}),s.$on("collapse",l[3]),s.$on("removeblock",l[4]),{c(){e=E("input"),a=te(),re(s.$$.fragment),this.h()},l(t){e=R(t,"INPUT",{type:!0,placeholder:!0}),a=le(t),se(s.$$.fragment,t),this.h()},h(){f(e,"type","text"),f(e,"placeholder","QRcode text (random)")},m(t,i){d(t,e,i),j(e,l[0]),d(t,a,i),ie(s,t,i),u=!0,n||(o=N(e,"input",l[2]),n=!0)},p(t,[i]){i&1&&e.value!==t[0]&&j(e,t[0]);const r={};i&1&&(r.text=t[0]),s.$set(r)},i(t){u||(p(s.$$.fragment,t),u=!0)},o(t){g(s.$$.fragment,t),u=!1},d(t){t&&_(e),t&&_(a),ae(s,t),n=!1,o()}}}function fe(l,e,a){let s="";const u=i=>`
    \u208D\u208D\u207D\u207D\u{1F533}\u208E\u208E\u207E\u207E

\u898B\u3066\uFF01QR\u30B3\u30FC\u30C9\u304C\u8E0A\u3063\u3066\u3044\u308B\u3088
\u304B\u308F\u3044\u3044\u306D

        \u{1F533}

\u307F\u3093\u306A\u304CQR\u30B3\u30FC\u30C9\u306E\u9ED2\u3044\u90E8\u5206\u3092\u6D88\u3057\u3066\u3057\u307E\u3063\u305F\u306E\u3067\u3001QR\u30B3\u30FC\u30C9\u306F\u8E0A\u308B\u306E\u3092\u3084\u3081\u3066\u3057\u307E\u3044\u307E\u3057\u305F
\u304A\u524D\u306E\u305B\u3044\u3067\u3059
\u3042\u301C\u3042 (\u8A18\u9332:${i}\u500B)`;function n(){s=this.value,a(0,s)}return[s,u,n,({detail:i})=>alert(u(i.removed)),()=>console.log("block removed")]}class me extends C{constructor(e){super();Q(this,e,fe,he,y,{})}}export{me as default};
