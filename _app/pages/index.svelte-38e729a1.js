import{J as ie,K as oe,L as ae,S as H,i as G,s as P,l as k,f as b,r as S,M as V,w as I,x as w,u as J,d as _,B as D,e as z,N as K,c as y,a as E,O,b as d,P as W,H as p,I as ne,p as he,Q as X,R as ce,T as ue,U as Y,V as B,W as fe,X as _e,t as Z,k as M,j as de,g as F,n as q,m as me,Y as x,o as ge,v as ve,Z as pe}from"../chunks/vendor-7812baef.js";class ke{constructor(e){this._size=e,this.matrix=[...Array(e*e)].map(()=>[255,255,255,255])}get size(){return this._size}setPixel(e,t,i){this.matrix[e+t*this.size]=i}rect(e,t,i,c){for(let a=0;a<i;a++)for(let s=0;s<c;s++)this.setPixel(e+a,t+s,[0,0,0,0])}toImageData(){return{data:new Uint8ClampedArray(this.matrix.flat()),width:this.size,height:this.size}}}const be=n=>new ke(n);class ze extends ie{constructor(e){super();this._text=e,this._removed=0,this._text||(this._text=Math.random().toString(36).substring(2));const t=oe.create(this._text,{}).modules;this.matrix=[...Array(t.size)].map((i,c)=>[...Array(t.size)].map((a,s)=>!!t.get(s,c)))}get text(){return this._text}get size(){return this.matrix.length}get removed(){return this._removed}addEventListener(e,t){super.on(e,t)}get(e,t){return this.rangeCheck(e),this.rangeCheck(t),this.matrix[t][e]}remove(e,t){if(!this.get(e,t))throw new Error("Not able to remove black area");this._removed++,this.matrix[t][e]=!1;const i=!this.validateQrCode();return i&&this.dispatchEvent("collapse",{removed:this.removed}),!i}rangeCheck(e){if(e>=this.size)throw new RangeError("Invalid index")}validateQrCode(){const{data:e,width:t,height:i}=this.toImageData(),c=ae(e,t,i);return(c==null?void 0:c.data)===this.text}toImageData(){const e=1,t=this.size*e*5,i=this.size*e,c=Math.floor((t-i)/2);console.log({blockSize:e,canvasSize:t,qrSize:i,margin:c});const a=be(t);for(let s=0;s<this.size;s++)for(let r=0;r<this.size;r++)this.get(s,r)&&a.rect(c+s*e,c+r*e,e,e);return a.toImageData()}dispatchEvent(e,t){this.emit(e,t)}}const ye=n=>new ze(n);function $(n,e,t){const i=n.slice();return i[9]=e[t],i}function ee(n,e,t){const i=n.slice();return i[12]=e[t],i}function te(n){let e,t,i,c,a,s,r;function h(){return n[8](n[12],n[9])}return{c(){e=K("rect"),this.h()},l(l){e=O(l,"rect",{x:!0,y:!0,width:!0,height:!0}),E(e).forEach(_),this.h()},h(){d(e,"x",t=n[12]*n[0]),d(e,"y",i=n[9]*n[0]),d(e,"width",n[0]),d(e,"height",n[0])},m(l,o){b(l,e,o),a=!0,s||(r=B(e,"click",h),s=!0)},p(l,o){n=l,(!a||o&17&&t!==(t=n[12]*n[0]))&&d(e,"x",t),(!a||o&17&&i!==(i=n[9]*n[0]))&&d(e,"y",i),(!a||o&1)&&d(e,"width",n[0]),(!a||o&1)&&d(e,"height",n[0])},i(l){a||(c&&c.end(1),a=!0)},o(l){c=fe(e,_e,{}),a=!1},d(l){l&&_(e),l&&c&&c.end(),s=!1,r()}}}function le(n,e){let t,i=e[4].get(e[12],e[9]),c,a,s=i&&te(e);return{key:n,first:null,c(){t=k(),s&&s.c(),c=k(),this.h()},l(r){t=k(),s&&s.l(r),c=k(),this.h()},h(){this.first=t},m(r,h){b(r,t,h),s&&s.m(r,h),b(r,c,h),a=!0},p(r,h){e=r,h&16&&(i=e[4].get(e[12],e[9])),i?s?(s.p(e,h),h&16&&w(s,1)):(s=te(e),s.c(),w(s,1),s.m(c.parentNode,c)):s&&(S(),J(s,1,1,()=>{s=null}),I())},i(r){a||(w(s),a=!0)},o(r){J(s),a=!1},d(r){r&&_(t),s&&s.d(r),r&&_(c)}}}function re(n,e){let t,i=[],c=new Map,a,s,r=[...Array(e[4].size).keys()];const h=l=>`${l[12]},${l[9]}`;for(let l=0;l<r.length;l+=1){let o=ee(e,r,l),u=h(o);c.set(u,i[l]=le(u,o))}return{key:n,first:null,c(){t=k();for(let l=0;l<i.length;l+=1)i[l].c();a=k(),this.h()},l(l){t=k();for(let o=0;o<i.length;o+=1)i[o].l(l);a=k(),this.h()},h(){this.first=t},m(l,o){b(l,t,o);for(let u=0;u<i.length;u+=1)i[u].m(l,o);b(l,a,o),s=!0},p(l,o){e=l,o&59&&(r=[...Array(e[4].size).keys()],S(),i=V(i,o,h,1,e,r,c,a.parentNode,Y,le,a,ee),I())},i(l){if(!s){for(let o=0;o<r.length;o+=1)w(i[o]);s=!0}},o(l){for(let o=0;o<i.length;o+=1)J(i[o]);s=!1},d(l){l&&_(t);for(let o=0;o<i.length;o+=1)i[o].d(l);l&&_(a)}}}function se(n){let e=[],t=new Map,i,c,a=[...Array(n[4].size).keys()];const s=r=>r[9];for(let r=0;r<a.length;r+=1){let h=$(n,a,r),l=s(h);t.set(l,e[r]=re(l,h))}return{c(){for(let r=0;r<e.length;r+=1)e[r].c();i=k()},l(r){for(let h=0;h<e.length;h+=1)e[h].l(r);i=k()},m(r,h){for(let l=0;l<e.length;l+=1)e[l].m(r,h);b(r,i,h),c=!0},p(r,h){h&59&&(a=[...Array(r[4].size).keys()],S(),e=V(e,h,s,1,r,a,t,i.parentNode,Y,re,i,$),I())},i(r){if(!c){for(let h=0;h<a.length;h+=1)w(e[h]);c=!0}},o(r){for(let h=0;h<e.length;h+=1)J(e[h]);c=!1},d(r){for(let h=0;h<e.length;h+=1)e[h].d(r);r&&_(i)}}}function Ee(n){let e,t,i=n[3],c,a,s=se(n),r=[n[6]],h={};for(let l=0;l<r.length;l+=1)h=D(h,r[l]);return{c(){e=z("div"),t=K("svg"),s.c(),this.h()},l(l){e=y(l,"DIV",{});var o=E(e);t=O(o,"svg",{version:!0,xmlns:!0,viewBox:!0,fill:!0,class:!0});var u=E(t);s.l(u),u.forEach(_),o.forEach(_),this.h()},h(){d(t,"version","1.1"),d(t,"xmlns","http://www.w3.org/2000/svg"),d(t,"viewBox",c="0 0 "+n[4].size*n[0]+" "+n[4].size*n[0]),d(t,"fill",n[2]),d(t,"class","svelte-1ofrr86"),W(e,h)},m(l,o){b(l,e,o),p(e,t),s.m(t,null),a=!0},p(l,[o]){o&8&&P(i,i=l[3])?(S(),J(s,1,1,ne),I(),s=se(l),s.c(),w(s),s.m(t,null)):s.p(l,o),(!a||o&17&&c!==(c="0 0 "+l[4].size*l[0]+" "+l[4].size*l[0]))&&d(t,"viewBox",c),(!a||o&4)&&d(t,"fill",l[2]),W(e,h=he(r,[o&64&&l[6]]))},i(l){a||(w(s),a=!0)},o(l){J(s),a=!1},d(l){l&&_(e),s.d(l)}}}function we(n,e,t){const i=["text","blockSize","autoJudge","color"];let c=X(e,i),{text:a="default"}=e,{blockSize:s=100}=e,{autoJudge:r=!0}=e,{color:h="black"}=e;const l=ce();let o=0,u;const R=(m,g)=>{const Q=u.remove(m,g);l("removeblock"),!Q&&r&&l("collapse",{removed:o}),t(3,o++,o)};return n.$$set=m=>{e=D(D({},e),ue(m)),t(6,c=X(e,i)),"text"in m&&t(7,a=m.text),"blockSize"in m&&t(0,s=m.blockSize),"autoJudge"in m&&t(1,r=m.autoJudge),"color"in m&&t(2,h=m.color)},n.$$.update=()=>{n.$$.dirty&128&&(t(4,u=ye(a)),t(3,o=0),l("reset"))},[s,r,h,o,u,l,c,a,R]}class Je extends H{constructor(e){super();G(this,e,we,Ee,P,{text:7,blockSize:0,autoJudge:1,color:2})}}function Qe(n){let e,t,i,c,a,s,r,h,l,o,u,R,m,g,Q,j,L;return g=new Je({props:{text:n[0],autoJudge:n[1],style:"max-width: 90vmin; max-height: 90vmin; margin: 0 auto;",color:"#246"}}),g.$on("collapse",n[5]),g.$on("removeblock",n[6]),{c(){e=z("header"),t=z("h1"),i=Z("QRcode Jenga"),c=M(),a=z("main"),s=z("p"),r=z("input"),h=M(),l=z("p"),o=z("label"),u=z("input"),R=Z(`
			Auto judge (\u81EA\u5206\u306E\u30B9\u30DE\u30DB\u3067\u5224\u5B9A\u3059\u308B\u5834\u5408\u306F\u30C1\u30A7\u30C3\u30AF\u3092\u5916\u3057\u3066\u304F\u3060\u3055\u3044)`),m=M(),de(g.$$.fragment),this.h()},l(f){e=y(f,"HEADER",{});var v=E(e);t=y(v,"H1",{});var C=E(t);i=F(C,"QRcode Jenga"),C.forEach(_),v.forEach(_),c=q(f),a=y(f,"MAIN",{});var A=E(a);s=y(A,"P",{});var T=E(s);r=y(T,"INPUT",{type:!0,placeholder:!0}),T.forEach(_),h=q(A),l=y(A,"P",{});var U=E(l);o=y(U,"LABEL",{});var N=E(o);u=y(N,"INPUT",{type:!0}),R=F(N,`
			Auto judge (\u81EA\u5206\u306E\u30B9\u30DE\u30DB\u3067\u5224\u5B9A\u3059\u308B\u5834\u5408\u306F\u30C1\u30A7\u30C3\u30AF\u3092\u5916\u3057\u3066\u304F\u3060\u3055\u3044)`),N.forEach(_),U.forEach(_),m=q(A),me(g.$$.fragment,A),A.forEach(_),this.h()},h(){d(r,"type","text"),d(r,"placeholder","QRcode text (random)"),d(u,"type","checkbox")},m(f,v){b(f,e,v),p(e,t),p(t,i),b(f,c,v),b(f,a,v),p(a,s),p(s,r),x(r,n[0]),p(a,h),p(a,l),p(l,o),p(o,u),u.checked=n[1],p(o,R),p(a,m),ge(g,a,null),Q=!0,j||(L=[B(r,"input",n[3]),B(u,"change",n[4])],j=!0)},p(f,[v]){v&1&&r.value!==f[0]&&x(r,f[0]),v&2&&(u.checked=f[1]);const C={};v&1&&(C.text=f[0]),v&2&&(C.autoJudge=f[1]),g.$set(C)},i(f){Q||(w(g.$$.fragment,f),Q=!0)},o(f){J(g.$$.fragment,f),Q=!1},d(f){f&&_(e),f&&_(c),f&&_(a),ve(g),j=!1,pe(L)}}}function Ce(n,e,t){let i="",c=!0;const a=o=>`
    \u208D\u208D\u207D\u207D\u{1F533}\u208E\u208E\u207E\u207E

\u898B\u3066\uFF01QR\u30B3\u30FC\u30C9\u304C\u8E0A\u3063\u3066\u3044\u308B\u3088
\u304B\u308F\u3044\u3044\u306D

        \u{1F533}

\u307F\u3093\u306A\u304CQR\u30B3\u30FC\u30C9\u306E\u9ED2\u3044\u90E8\u5206\u3092\u6D88\u3057\u3066\u3057\u307E\u3063\u305F\u306E\u3067\u3001QR\u30B3\u30FC\u30C9\u306F\u8E0A\u308B\u306E\u3092\u3084\u3081\u3066\u3057\u307E\u3044\u307E\u3057\u305F
\u304A\u524D\u306E\u305B\u3044\u3067\u3059
\u3042\u301C\u3042 (\u8A18\u9332:${o}\u500B)`;function s(){i=this.value,t(0,i)}function r(){c=this.checked,t(1,c)}return[i,c,a,s,r,({detail:o})=>alert(a(o.removed)),()=>console.log("block removed")]}class Re extends H{constructor(e){super();G(this,e,Ce,Qe,P,{})}}export{Re as default};
